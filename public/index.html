<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stockfish WASM — Test Page</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 20px; }
    pre { background:#f6f8fa; padding:12px; border-radius:6px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <h1>Stockfish WASM Test</h1>
  <p>Open DevTools → Console to view engine output. This page will start the worker wrapper.</p>

  <pre id="notes">
1) This page uses a wrapper worker at /engine/stockfish-worker.js
2) The wrapper sets Module.locateFile then importScripts('/engine/stockfish.js')
3) If the engine fails, check Network for /engine/stockfish.wasm and Console for errors.
  </pre>

  <script>
    // single place to change if you host differently
    const WORKER_PATH = '/engine/stockfish-worker.js'; // absolute path (Firebase / hosting)

    // Create and test the worker
    (function () {
      try {
        const sf = new Worker(WORKER_PATH);

        // Diagnostic handlers so errors don't hide
        sf.onmessage = (e) => {
          console.log('Stockfish (worker):', e.data);
        };
        sf.onmessageerror = (ev) => {
          console.error('Stockfish worker messageerror:', ev);
        };
        sf.onerror = (ev) => {
          console.error('Stockfish worker onerror:', ev);
        };

        // Minimal handshake + short analysis
        // UCI expects: 'uci' -> 'uciok', then 'isready' -> 'readyok'
        sf.postMessage('uci');
        // Wait a tiny bit for the uci response to land, but post is fine
        sf.postMessage('isready');

        // analyze the starting position for 1s to produce messages
        sf.postMessage('position startpos');
        sf.postMessage('go movetime 1000');

        // expose for interactive testing in console
        window._stockfishWorker = sf;
        console.log('Stockfish worker created and attached to window._stockfishWorker');
      } catch (err) {
        console.error('Failed to create Stockfish worker:', err);
      }
    })();
  </script>
</body>
</html>
